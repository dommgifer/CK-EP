# Kubernetes è€ƒè©¦æ¨¡æ“¬å™¨ - å¿«é€Ÿå…¥é–€æŒ‡å—

## ç³»çµ±æ¦‚è¿°

æœ¬ç³»çµ±æä¾›å®Œæ•´çš„ Kubernetes èªè­‰è€ƒè©¦æ¨¡æ“¬ç’°å¢ƒï¼Œæ”¯æ´ CKADã€CKAã€CKS ä¸‰ç¨®èªè­‰é¡å‹çš„ç·´ç¿’ã€‚ç³»çµ±è‡ªå‹•åŒ–éƒ¨ç½² Kubernetes ç’°å¢ƒåˆ°ä½¿ç”¨è€…æŒ‡å®šçš„ VM å¢é›†ï¼Œä¸¦æä¾› Web ä»‹é¢é€²è¡Œé ç«¯æ¡Œé¢å­˜å–å’Œå³æ™‚è©•åˆ†ã€‚

## ç’°å¢ƒéœ€æ±‚

### ç¡¬é«”éœ€æ±‚
- **é–‹ç™¼æ©Ÿå™¨**: 8GB RAM, 4 CPU cores, 20GB å¯ç”¨ç¡¬ç¢Ÿç©ºé–“
- **ç›®æ¨™ VM å¢é›†**:
  - Master ç¯€é»: 2GB RAM, 2 CPU cores
  - Worker ç¯€é»: 1GB RAM, 1 CPU core (æ¯å€‹)
  - ç¶²è·¯: å„ç¯€é»é–“å¯äº’é€šï¼Œæ”¯æ´ SSH é€£ç·š

### è»Ÿé«”éœ€æ±‚
- Docker 20.10+ å’Œ Docker Compose v2
- Git
- ç›®æ¨™ VM é‹è¡Œ Ubuntu 20.04+ æˆ– CentOS 8+
- SSH é‡‘é‘°å°æˆ–å¯†ç¢¼èªè­‰

## å¿«é€Ÿå®‰è£

### 1. å…‹éš†å°ˆæ¡ˆ
```bash
git clone <repository-url>
cd kubernetes-exam-simulator
```

### 2. ç’°å¢ƒé…ç½®
```bash
# è¤‡è£½ç’°å¢ƒé…ç½®ç¯„æœ¬
cp .env.example .env

# ç·¨è¼¯é…ç½®æª”æ¡ˆ
nano .env
```

ä¸»è¦é…ç½®é …ç›®ï¼š
```env
# è³‡æ–™åº«è¨­å®š
DATABASE_URL=sqlite:///data/exam_simulator.db
REDIS_URL=redis://redis:6379/0

# VNC è¨­å®š
VNC_PASSWORD=secure_password
VNC_DISPLAY=:1

# SSH è¨­å®š
SSH_KEY_DIR=/app/data/ssh_keys

# æ—¥èªŒè¨­å®š
LOG_LEVEL=INFO
```

### 3. å•Ÿå‹•ç³»çµ±
```bash
# å»ºæ§‹å’Œå•Ÿå‹•æ‰€æœ‰æœå‹™
docker-compose up -d

# æª¢æŸ¥æœå‹™ç‹€æ…‹
docker-compose ps
```

æœå‹™å•Ÿå‹•å¾Œï¼Œç³»çµ±é€é nginx åå‘ä»£ç†æä¾›çµ±ä¸€å…¥å£ï¼š
- **Web ä»‹é¢**: http://192.168.1.10 (è«‹æ›¿æ›ç‚ºå¯¦éš›ä¼ºæœå™¨ IP)
- **API æ–‡ä»¶**: http://192.168.1.10/docs

**æ¶æ§‹èªªæ˜**ï¼š
- nginx ä½œç‚ºçµ±ä¸€å…¥å£é» (port 80)ï¼Œè‡ªå‹•è·¯ç”±å‰ç«¯éœæ…‹æª”æ¡ˆå’Œ API è«‹æ±‚
- å‰ç«¯é€éç›¸å°è·¯å¾‘ `/api/v1/*` å‘¼å«å¾Œç«¯æœå‹™
- ç„¡éœ€æš´éœ²å¤šå€‹ç«¯å£ï¼Œæ”¯æ´å‹•æ…‹ IP è®Šæ›´

## ç³»çµ±ç¶²è·¯æ¶æ§‹

### æ•´é«”éƒ¨ç½²æ¶æ§‹
```
ä½¿ç”¨è€…ç€è¦½å™¨ (192.168.1.x)
    â†“ HTTP/HTTPS (port 80/443)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  nginx åå‘ä»£ç†å®¹å™¨                     â”‚
â”‚  â”œâ”€â”€ å‰ç«¯éœæ…‹æª”æ¡ˆæœå‹™ (/)               â”‚
â”‚  â”œâ”€â”€ API è«‹æ±‚ä»£ç† (/api/* â†’ backend)    â”‚
â”‚  â””â”€â”€ VNC é€£ç·šä»£ç† (/vnc/* â†’ vnc)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ Docker å…§éƒ¨ç¶²è·¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ frontend    â”‚ backend     â”‚ vnc         â”‚
â”‚ (éœæ…‹æª”æ¡ˆ)  â”‚ :8000       â”‚ :5901       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Redis       â”‚ â”‚ SQLite      â”‚
    â”‚ :6379       â”‚ â”‚ (æª”æ¡ˆ)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è«‹æ±‚æµç¨‹åœ–
```
1. ä½¿ç”¨è€…å­˜å– â†’ http://192.168.1.10
2. nginx è·¯ç”±æ±ºç­–ï¼š
   â”œâ”€â”€ / â†’ å‰ç«¯éœæ…‹æª”æ¡ˆ
   â”œâ”€â”€ /api/v1/* â†’ backend:8000
   â””â”€â”€ /vnc/* â†’ vnc:5901

3. è€ƒè©¦æœƒè©±å»ºç«‹æµç¨‹ï¼š
   ç€è¦½å™¨ â†’ nginx â†’ backend â†’ Kubespray å®¹å™¨æœå‹™ â†’ ä½¿ç”¨è€… VM å¢é›†
                           â†“                      â†“
                    API å‘¼å«å®¹å™¨å…§è…³æœ¬        SSH é€£ç·š (port 22)
                    å‹•æ…‹å‰µå»º session é…ç½®

   Docker å®¹å™¨å…§åŸ·è¡Œï¼š
   1. mkdir /kubespray/data/{session_id}
   2. ç”Ÿæˆ inventory/hosts.yaml
   3. ansible-playbook -i inventory/hosts.yaml cluster.yml

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ä½¿ç”¨è€… VM å¢é›†                          â”‚
   â”‚ â”œâ”€â”€ Master ç¯€é» (192.168.1.100)        â”‚
   â”‚ â”‚   â””â”€â”€ å®‰è£ Kubernetes control plane   â”‚
   â”‚ â””â”€â”€ Worker ç¯€é» (192.168.1.101)        â”‚
   â”‚     â””â”€â”€ åŠ å…¥ Kubernetes å¢é›†           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### VNC é€£ç·šæ¶æ§‹
```
ç€è¦½å™¨ noVNC å®¢æˆ¶ç«¯
    â†“ WebSocket
nginx (/vnc/* ä»£ç†)
    â†“
VNC å®¹å™¨ (æ¡Œé¢ç’°å¢ƒ)
    â†“ kubectl å‘½ä»¤
Kubernetes å¢é›† (ä½¿ç”¨è€… VM)
```

### 4. åˆå§‹åŒ–è³‡æ–™åº«
```bash
# åŸ·è¡Œè³‡æ–™åº«é·ç§»
docker-compose exec backend python -m alembic upgrade head

# è¼‰å…¥ç¯„ä¾‹é¡Œçµ„ (å¯é¸)
docker-compose exec backend python scripts/load_sample_questions.py
```

## åŸºæœ¬ä½¿ç”¨æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šé…ç½® VM å¢é›†

1. é–‹å•Ÿ Web ä»‹é¢ (http://192.168.1.10ï¼Œè«‹æ›¿æ›ç‚ºå¯¦éš›ä¼ºæœå™¨ IP)
2. å°èˆªåˆ°ã€ŒVM é…ç½®ã€é é¢
3. é»é¸ã€Œæ–°å¢é…ç½®ã€
4. è¼¸å…¥ä»¥ä¸‹è³‡è¨Šï¼š
   - é…ç½®åç¨±
   - Master ç¯€é» IP åœ°å€
   - Worker ç¯€é» IP åœ°å€ (å¯é¸)
   - SSH ä½¿ç”¨è€…åç¨±
   - SSH ç§é‘°æˆ–å¯†ç¢¼

ç¯„ä¾‹é…ç½®ï¼š
```json
{
  "name": "Lab Environment",
  "master_nodes": [
    {
      "ip_address": "192.168.1.100",
      "hostname": "k8s-master",
      "role": "master",
      "ssh_port": 22
    }
  ],
  "worker_nodes": [
    {
      "ip_address": "192.168.1.101",
      "hostname": "k8s-worker1",
      "role": "worker",
      "ssh_port": 22
    }
  ],
  "ssh_username": "ubuntu"
}
```

5. é»é¸ã€Œæ¸¬è©¦é€£ç·šã€ç¢ºèªå¯ä»¥é€£æ¥åˆ°æ‰€æœ‰ç¯€é»
6. å„²å­˜é…ç½®

### ç¬¬äºŒæ­¥ï¼šé¸æ“‡æˆ–å»ºç«‹é¡Œçµ„

#### ä½¿ç”¨é è¨­é¡Œçµ„
1. å°èˆªåˆ°ã€Œé¡Œçµ„ç®¡ç†ã€é é¢
2. é¸æ“‡é©åˆçš„èªè­‰é¡å‹ (CKA/CKAD/CKS)
3. æª¢è¦–é¡Œçµ„è©³æƒ…å’Œé¡Œç›®åˆ—è¡¨

#### å»ºç«‹è‡ªå®šç¾©é¡Œçµ„

é¡Œçµ„é€é JSON æª”æ¡ˆç®¡ç†ï¼Œéœ€è¦åœ¨æª”æ¡ˆç³»çµ±ä¸­å»ºç«‹å°æ‡‰çš„ç›®éŒ„çµæ§‹ï¼š

1. **å»ºç«‹é¡Œçµ„ç›®éŒ„**ï¼š
   ```bash
   # åœ¨ data/question_sets/ ä¸‹å»ºç«‹æ–°çš„é¡Œçµ„ç›®éŒ„
   mkdir -p data/question_sets/cka/002

   # å»ºç«‹è…³æœ¬å’Œç¶²è·¯é…ç½®ç›®éŒ„
   mkdir -p data/question_sets/cka/002/scripts/{verify,prepare}
   mkdir -p data/question_sets/cka/002/network
   ```

2. **å»ºç«‹ metadata.json**ï¼š
   ```json
   {
     "exam_type": "CKA",
     "set_id": "002",
     "name": "CKA é€²éšæ¨¡æ“¬æ¸¬é©—",
     "description": "æ¶µè“‹ CKA é€²éšä¸»é¡Œçš„å¯¦æˆ°ç·´ç¿’",
     "difficulty": "hard",
     "time_limit": 180,
     "total_questions": 12,
     "passing_score": 70,
     "created_date": "2025-09-22",
     "version": "1.0",
     "tags": ["advanced", "troubleshooting", "networking"],
     "topics": [
       {
         "name": "å¢é›†ç¶­è­·",
         "weight": 30,
         "questions": 4,
         "description": "ç¯€é»ç¶­è­·ã€å‡ç´šã€å‚™ä»½"
       }
     ]
   }
   ```

3. **å»ºç«‹ questions.json**ï¼š
   ```json
   {
     "set_info": {
       "exam_type": "CKA",
       "set_id": "002",
       "name": "CKA é€²éšæ¨¡æ“¬æ¸¬é©—"
     },
     "questions": [
       {
         "id": 1,
         "content": "## ä»»å‹™\n\nåœ¨æŒ‡å®šçš„ namespace ä¸­å»ºç«‹ä¸€å€‹ Podï¼Œä¸¦è¨­å®šé©ç•¶çš„è³‡æºé™åˆ¶...",
         "weight": 8.5,
         "kubernetes_objects": ["Pod", "ResourceQuota"],
         "hints": [
           "æª¢æŸ¥ Pod çš„è³‡æºé…ç½®",
           "ä½¿ç”¨ kubectl describe æŸ¥çœ‹è©³ç´°è³‡è¨Š"
         ],
         "verification_scripts": ["q1_check_pod.sh", "q1_check_resources.sh"],
         "preparation_scripts": ["setup_namespace.sh"]
       }
     ]
   }
   ```

4. **å»ºç«‹ Kubespray é…ç½®æª”æ¡ˆ**ï¼ˆé¸ç”¨ï¼‰ï¼š

   å¦‚æœè©²é¡Œçµ„éœ€è¦ç‰¹æ®Šçš„ Kubernetes ç’°å¢ƒé…ç½®ï¼Œå¯ä»¥å»ºç«‹ä»¥ä¸‹æª”æ¡ˆï¼š

   ```bash
   # å»ºç«‹åŸºç¤é…ç½®è¦†è“‹æª”æ¡ˆï¼ˆè¦†è“‹ templates/base.ymlï¼‰
   cat > data/question_sets/cka/002/base-overwrite.yml << 'EOF'
   # åªéœ€è¦å®šç¾©éœ€è¦æ”¹è®Šçš„é…ç½®
   kube_version: v1.28.8
   cluster_name: cka-002-cluster

   # å¦‚æœéœ€è¦ç‰¹æ®Šçš„ kubelet é…ç½®
   kubelet_config_extra_args:
     maxPods: 200
   EOF

   # å»ºç«‹ addon é…ç½®è¦†è“‹æª”æ¡ˆï¼ˆè¦†è“‹ templates/addons.ymlï¼‰
   cat > data/question_sets/cka/002/addons-overwrite.yml << 'EOF'
   # å•Ÿç”¨é¡å¤–çš„ addon
   ingress_nginx_enabled: true
   metrics_server_enabled: true
   EOF

   # å»ºç«‹ç¶²è·¯é…ç½®ç›®éŒ„å’Œ CNI é…ç½®æª”æ¡ˆï¼ˆå¦‚æœéœ€è¦ç‰¹å®š CNIï¼‰
   mkdir -p data/question_sets/cka/002/network

   # å»ºç«‹ Calico CNI é…ç½®
   cat > data/question_sets/cka/002/network/k8s-net-calico.yml << 'EOF'
   # Calico CNI é…ç½®
   kube_network_plugin: calico
   calico_network_backend: bird
   calico_ipip_mode: Always
   EOF

   # å¯ä»¥æ ¹æ“šéœ€è¦æ–°å¢æ›´å¤šç¶²è·¯é…ç½®æª”æ¡ˆ
   # cat > data/question_sets/cka/002/network/custom-network.yml << 'EOF'
   # # è‡ªå®šç¾©ç¶²è·¯é…ç½®
   # EOF
   ```

5. **é‡è¼‰é¡Œçµ„è³‡æ–™**ï¼š
   ```bash
   curl -X POST http://192.168.1.10/api/v1/question-sets/reload
   ```

### ç¬¬ä¸‰æ­¥ï¼šé–‹å§‹è€ƒè©¦æœƒè©±

1. å°èˆªåˆ°ã€Œè€ƒè©¦ç®¡ç†ã€é é¢
2. é»é¸ã€Œé–‹å§‹æ–°è€ƒè©¦ã€
3. é¸æ“‡ï¼š
   - èªè­‰é¡å‹
   - é¡Œçµ„
   - VM é…ç½®

4. é»é¸ã€Œå»ºç«‹æœƒè©±ã€
5. ç³»çµ±å°‡åŒæ™‚å•Ÿå‹•å…©å€‹å¹³è¡Œæµç¨‹ï¼š

   **ğŸ”§ è€ƒè©¦å®¹å™¨å•Ÿå‹•** (ç«‹å³é–‹å§‹)ï¼š
   - å•Ÿå‹• VNC Container (åŸºæ–¼ ConSol debian-xfce-vnc)
   - å•Ÿå‹• Bastion Container (Alpine åŸºåº•ï¼ŒåŒ…å«è€ƒè©¦å·¥å…·)
   - é…ç½® VNC åˆ° Bastion çš„ SSH é€£ç·š
   - ä½¿ç”¨è€…å¯ç«‹å³çœ‹åˆ°æ¡Œé¢ç’°å¢ƒ (VNC ä»‹é¢å¯ç”¨)

   **âš™ï¸ Kubernetes ç’°å¢ƒé…ç½®** (ä¸¦è¡ŒåŸ·è¡Œ)ï¼š
   - é©—è­‰ VM é€£ç·š
   - è®€å–é¡Œçµ„çš„ Kubespray é…ç½®æª”æ¡ˆ
   - åŸ·è¡Œé…ç½®åˆä½µï¼ˆbase + overwriteï¼‰
   - æƒæé¡Œçµ„çš„ network/ ç›®éŒ„ï¼Œæ”¶é›†æ‰€æœ‰ CNI é…ç½®
   - åœ¨ Kubespray å®¹å™¨å…§å‰µå»º session é…ç½®ç›®éŒ„
   - ç”Ÿæˆåˆä½µå¾Œçš„ k8s-cluster.ymlã€addons.yml
   - è¤‡è£½æ‰€æœ‰ network/ ç›®éŒ„ä¸‹çš„ç¶²è·¯é…ç½®æª”æ¡ˆ
   - è¤‡è£½ etcd è¨­å®šæª”æ¡ˆ
   - ç”Ÿæˆ Ansible inventory æª”æ¡ˆ
   - åŸ·è¡Œå®˜æ–¹ Kubespray playbook
   - åœ¨ä½¿ç”¨è€… VM ä¸Šå®‰è£å’Œé…ç½® Kubernetes

6. **å³æ™‚ Ansible éƒ¨ç½²è¼¸å‡º**ï¼š
   - ç³»çµ±ä»‹é¢å³æ™‚é¡¯ç¤º Ansible playbook åŸç”Ÿè¼¸å‡º
   - å®Œæ•´çš„ä»»å‹™åŸ·è¡Œæ—¥èªŒå’Œç¯€é»ç‹€æ…‹
   - çœŸå¯¦çš„å®‰è£é€²åº¦å’ŒéŒ¯èª¤è¨Šæ¯
   - ç¬¦åˆæŠ€è¡“å°ˆå®¶ç¿’æ…£çš„çµ‚ç«¯æ©Ÿé¢¨æ ¼ä»‹é¢
   - é€æ˜ä¸”å¯é™¤éŒ¯çš„å®Œæ•´éƒ¨ç½²éç¨‹

   **Ansible è¼¸å‡ºç¯„ä¾‹**ï¼š
   ```
   PLAY [Download and install Kubernetes] *************************

   TASK [Download kubectl binary] *********************************
   changed: [master-01]
   changed: [worker-01]
   ok: [worker-02]

   TASK [Configure kubelet service] *******************************
   running: [master-01]
   running: [worker-01]
   running: [worker-02]

   TASK [Start kubelet] ********************************************
   ok: [master-01]
   failed: [worker-01] => {"msg": "Service failed to start"}
   ok: [worker-02]
   ```

7. Kubernetes ç’°å¢ƒé…ç½®å®Œæˆå¾Œï¼š
   - è‡ªå‹•å°‡ kubeconfig æ›è¼‰åˆ° Bastion Container
   - æ›´æ–° Bastion å…§çš„é€£ç·šé…ç½®
   - ç³»çµ±è‡ªå‹•è·³è½‰åˆ° VNC é é¢
   - é é¢é¡¯ç¤ºæ¡Œé¢ç’°å¢ƒï¼ˆå·¦å´é¡Œç›®é¢æ¿ï¼Œå³å´ VNC æ¡Œé¢ï¼‰
   - å½ˆå‡ºã€Œé–‹å§‹è€ƒè©¦ã€æŒ‰éˆ•è¦†è“‹å±¤

8. é»é¸ã€Œé–‹å§‹è€ƒè©¦ã€

### ç¬¬å››æ­¥ï¼šé€²è¡Œè€ƒè©¦

1. é»é¸ã€Œé–‹å§‹è€ƒè©¦ã€å¾Œï¼Œè¦†è“‹å±¤æ¶ˆå¤±ï¼Œè€ƒè©¦æ­£å¼é–‹å§‹ï¼š
   - **å·¦å´é¢æ¿**ï¼šé¡Œç›®æè¿°å’Œå°èˆª
   - **å³å´é¢æ¿**ï¼šVNC é ç«¯æ¡Œé¢ (noVNC ä»‹é¢)
   - è€ƒè©¦è¨ˆæ™‚å™¨é–‹å§‹å€’æ•¸

2. åœ¨ VNC é ç«¯æ¡Œé¢ç’°å¢ƒä¸­ï¼š
   - é–‹å•Ÿçµ‚ç«¯æ©Ÿ
   - åŸ·è¡Œ `ssh bastion` é€£ç·šåˆ°å·¥å…·ç’°å¢ƒ
   - åœ¨ Bastion å…§ä½¿ç”¨ kubectlã€helm ç­‰å·¥å…·
   - å®Œæˆé¡Œç›®è¦æ±‚

3. é¡Œç›®å°èˆªï¼š
   - ä½¿ç”¨ã€Œä¸Šä¸€é¡Œã€/ã€Œä¸‹ä¸€é¡Œã€æŒ‰éˆ•
   - æŸ¥çœ‹é€²åº¦æ¢å’Œå‰©é¤˜æ™‚é–“
   - æ¨™è¨˜å·²å®Œæˆçš„é¡Œç›®

4. æäº¤ç­”æ¡ˆï¼š
   - å®Œæˆé¡Œç›®å¾Œé»é¸ã€Œæäº¤ç­”æ¡ˆã€
   - ç³»çµ±åœ¨ Bastion Container å…§åŸ·è¡Œé©—è­‰è…³æœ¬
   - å³æ™‚é¡¯ç¤ºå¾—åˆ†å’Œè©³ç´°å›é¥‹

### VNC + Bastion é›™å®¹å™¨æ¶æ§‹èªªæ˜

**æ¶æ§‹å„ªå‹¢**ï¼š
- **VNC Container**ï¼šå°ˆæ³¨æä¾›ç©©å®šçš„æ¡Œé¢ç’°å¢ƒï¼ŒåŸºæ–¼æˆç†Ÿçš„ ConSol æ˜ åƒ
- **Bastion Container**ï¼šAlpine 3.19 åŸºåº•ï¼Œè¼•é‡åŒ–è¨­è¨ˆ (~50MB vs Ubuntu 220MB)
- **é€šç”¨å·¥å…·é›†**ï¼šåŒ…å« kubectlã€helmã€jqã€yq ç­‰æ‰€æœ‰èªè­‰è€ƒè©¦å·¥å…·
- **è·è²¬åˆ†é›¢**ï¼šæ¡Œé¢é¡¯ç¤ºèˆ‡å·¥å…·åŸ·è¡Œåˆ†é›¢ï¼Œæé«˜ç©©å®šæ€§å’Œå®‰å…¨æ€§
- **å¿«é€Ÿå•Ÿå‹•**ï¼šæ¥µè¼•é‡æ˜ åƒï¼Œå®¹å™¨å•Ÿå‹•æ™‚é–“å¤§å¹…ç¸®çŸ­

**ä½¿ç”¨æµç¨‹**ï¼š
1. ç€è¦½å™¨ â†’ nginx â†’ VNC Container (noVNC ä»‹é¢)
2. VNC æ¡Œé¢ â†’ é–‹å•Ÿçµ‚ç«¯æ©Ÿ â†’ `ssh bastion`
3. Bastion ç’°å¢ƒ â†’ åŸ·è¡Œ kubectl å‘½ä»¤ â†’ æ“ä½œ K8s å¢é›†

### ç¬¬äº”æ­¥ï¼šæª¢è¦–çµæœ

1. è€ƒè©¦å®Œæˆæˆ–æ™‚é–“åˆ°æœŸå¾Œï¼Œç³»çµ±è‡ªå‹•ç”Ÿæˆçµæœå ±å‘Š
2. çµæœåŒ…å«ï¼š
   - ç¸½åˆ†å’Œå„é¡Œç›®å¾—åˆ†
   - å®Œæˆæ™‚é–“
   - è©³ç´°çš„é©—è­‰çµæœ
   - è§£é¡Œå»ºè­°å’Œåƒè€ƒç­”æ¡ˆ

## API ä½¿ç”¨ç¯„ä¾‹

### æº–å‚™ SSH é‡‘é‘°
```bash
# 1. ç”Ÿæˆ SSH é‡‘é‘°å°ï¼ˆå¦‚æœé‚„æ²’æœ‰ï¼‰
ssh-keygen -t rsa -b 2048 -f ~/.ssh/id_rsa

# 2. è¤‡è£½ç§é‘°åˆ°æŒ‡å®šç›®éŒ„
cp ~/.ssh/id_rsa ./data/ssh_keys/
chmod 600 ./data/ssh_keys/id_rsa

# 3. åœ¨æ‰€æœ‰ VM ç¯€é»å®‰è£å…¬é‘°
ssh-copy-id -i ~/.ssh/id_rsa.pub ubuntu@192.168.1.100
ssh-copy-id -i ~/.ssh/id_rsa.pub ubuntu@192.168.1.101

# 4. é©—è­‰é€£ç·š
ssh -i ./data/ssh_keys/id_rsa ubuntu@192.168.1.100
```

### å»ºç«‹ VM é…ç½®
```bash
curl -X POST http://192.168.1.10/api/v1/vm-configs \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Environment",
    "master_nodes": [
      {
        "ip_address": "192.168.1.100",
        "role": "master",
        "ssh_port": 22
      }
    ],
    "worker_nodes": [
      {
        "ip_address": "192.168.1.101",
        "role": "worker",
        "ssh_port": 22
      }
    ],
    "ssh_username": "ubuntu"
  }'
```

### æ¸¬è©¦ VM é€£ç·š
```bash
curl -X POST http://192.168.1.10/api/v1/vm-configs/{config_id}/test-connection
```

### å»ºç«‹è€ƒè©¦æœƒè©±
```bash
curl -X POST http://192.168.1.10/api/v1/exam-sessions \
  -H "Content-Type: application/json" \
  -d '{
    "exam_type": "CKA",
    "question_set_id": "cka-001",
    "vm_cluster_config_id": "uuid-here"
  }'
```

### æŸ¥çœ‹ç’°å¢ƒç‹€æ…‹
```bash
curl http://192.168.1.10/api/v1/exam-sessions/{session_id}/environment/status
```

### é¡Œçµ„ç®¡ç†

#### æŸ¥çœ‹æ‰€æœ‰é¡Œçµ„
```bash
curl http://192.168.1.10/api/v1/question-sets
```

#### æŸ¥çœ‹ç‰¹å®šèªè­‰é¡å‹çš„é¡Œçµ„
```bash
curl "http://192.168.1.10/api/v1/question-sets?exam_type=CKA"
```

#### æŸ¥çœ‹é¡Œçµ„è©³æƒ…
```bash
curl http://192.168.1.10/api/v1/question-sets/cka-001
```

#### é‡è¼‰é¡Œçµ„æª”æ¡ˆ
```bash
curl -X POST http://192.168.1.10/api/v1/question-sets/reload
```

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. VM é€£ç·šå¤±æ•—
**ç—‡ç‹€**: æ¸¬è©¦é€£ç·šè¿”å›å¤±æ•—
**è§£æ±ºæ–¹æ¡ˆ**:
- æª¢æŸ¥ IP åœ°å€æ˜¯å¦æ­£ç¢º
- ç¢ºèª SSH æœå‹™æ­£åœ¨é‹è¡Œ
- é©—è­‰é˜²ç«ç‰†è¨­å®š
- æª¢æŸ¥ SSH é‡‘é‘°æ¬Šé™ (600)

#### 2. Kubespray éƒ¨ç½²å¤±æ•—
**ç—‡ç‹€**: ç’°å¢ƒé…ç½®åœæ»¯æˆ–å ±éŒ¯
**è§£æ±ºæ–¹æ¡ˆ**:
- æª¢æŸ¥ VM è³‡æºæ˜¯å¦è¶³å¤ 
- ç¢ºèªç¶²è·¯é€£ç·šç©©å®š
- æŸ¥çœ‹ Ansible éƒ¨ç½²æ—¥èªŒ
- é©—è­‰ VM ç³»çµ±ç‰ˆæœ¬ç›¸å®¹æ€§

#### 3. VNC é€£ç·šå•é¡Œ
**ç—‡ç‹€**: ç„¡æ³•é€£æ¥åˆ°é ç«¯æ¡Œé¢
**è§£æ±ºæ–¹æ¡ˆ**:
- æª¢æŸ¥ VNC å®¹å™¨ç‹€æ…‹
- ç¢ºèªç«¯å£æ˜ å°„æ­£ç¢º
- æª¢æŸ¥é˜²ç«ç‰†è¨­å®š
- é‡å•Ÿ VNC æœå‹™

#### 4. é©—è­‰è…³æœ¬åŸ·è¡Œå¤±æ•—
**ç—‡ç‹€**: é¡Œç›®è©•åˆ†ç•°å¸¸
**è§£æ±ºæ–¹æ¡ˆ**:
- æª¢æŸ¥è…³æœ¬æ¬Šé™
- ç¢ºèª kubectl é…ç½®æ­£ç¢º
- é©—è­‰ Kubernetes å¢é›†ç‹€æ…‹
- æŸ¥çœ‹è…³æœ¬åŸ·è¡Œæ—¥èªŒ

#### 5. é¡Œçµ„æª”æ¡ˆè¼‰å…¥å¤±æ•—
**ç—‡ç‹€**: é¡Œçµ„åˆ—è¡¨ç‚ºç©ºæˆ–é¡¯ç¤ºéŒ¯èª¤
**è§£æ±ºæ–¹æ¡ˆ**:
- æª¢æŸ¥ JSON æª”æ¡ˆæ ¼å¼æ˜¯å¦æ­£ç¢º
- ç¢ºèª metadata.json å’Œ questions.json éƒ½å­˜åœ¨
- é©—è­‰æª”æ¡ˆæ¬Šé™
- æŸ¥çœ‹å¾Œç«¯æ—¥èªŒä¸­çš„éŒ¯èª¤è¨Šæ¯
- æ‰‹å‹•é‡è¼‰é¡Œçµ„æª”æ¡ˆ

```bash
# é©—è­‰ JSON æ ¼å¼
cat data/question_sets/cka/001/metadata.json | jq .

# æª¢æŸ¥æª”æ¡ˆæ¬Šé™
ls -la data/question_sets/cka/001/

# æ‰‹å‹•é‡è¼‰
curl -X POST http://192.168.1.10/api/v1/question-sets/reload
```

#### 6. æª”æ¡ˆç›£æ§ä¸å·¥ä½œ
**ç—‡ç‹€**: ä¿®æ”¹ JSON æª”æ¡ˆå¾Œç³»çµ±æœªè‡ªå‹•é‡è¼‰
**è§£æ±ºæ–¹æ¡ˆ**:
- é‡å•Ÿå¾Œç«¯æœå‹™
- æª¢æŸ¥æª”æ¡ˆç³»çµ±ç›£æ§æ—¥èªŒ
- æ‰‹å‹•è§¸ç™¼é‡è¼‰

### æ—¥èªŒæª¢æŸ¥
```bash
# æª¢è¦–æ‰€æœ‰æœå‹™æ—¥èªŒ
docker-compose logs

# æª¢è¦–ç‰¹å®šæœå‹™æ—¥èªŒ
docker-compose logs backend
docker-compose logs frontend
docker-compose logs vnc

# å³æ™‚æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f backend
```

### é‡è¨­ç³»çµ±
```bash
# åœæ­¢æ‰€æœ‰æœå‹™
docker-compose down

# æ¸…é™¤è³‡æ–™ (è¬¹æ…ä½¿ç”¨)
docker-compose down -v
rm -rf data/

# é‡æ–°å•Ÿå‹•
docker-compose up -d
```

## é€²éšé…ç½®

### è‡ªå®šç¾© Kubespray é…ç½®
åœ¨ `kubespray-configs/templates/` ç›®éŒ„ä¸‹ä¿®æ”¹ï¼š
- `base.yml`: åŸºç¤ Kubernetes é…ç½®
- `addons.yml`: æ’ä»¶é…ç½®
- `all/etcd.yml`: etcd é…ç½®

### æ–°å¢é©—è­‰è…³æœ¬ç¯„æœ¬
åœ¨ `scripts/verification/` ç›®éŒ„ä¸‹æ–°å¢è…³æœ¬ï¼š
```bash
#!/bin/bash
# ç¯„ä¾‹é©—è­‰è…³æœ¬

# æª¢æŸ¥ Pod æ˜¯å¦å­˜åœ¨
if kubectl get pod resource-pod &>/dev/null; then
    echo "PASS: Pod exists"
    exit 0
else
    echo "FAIL: Pod not found"
    exit 1
fi
```

### æ•ˆèƒ½èª¿å„ª
ä¿®æ”¹ `docker-compose.yml` ä¸­çš„è³‡æºé™åˆ¶ï¼š
```yaml
services:
  backend:
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
```

## æ”¯æ´å’Œç¤¾ç¾¤

- **å•é¡Œå›å ±**: [GitHub Issues](repository-url/issues)
- **æ–‡ä»¶**: [å®Œæ•´æ–‡ä»¶](docs-url)
- **è²¢ç»æŒ‡å—**: [CONTRIBUTING.md](CONTRIBUTING.md)

---

é€™å€‹å¿«é€Ÿå…¥é–€æŒ‡å—æ¶µè“‹äº†ç³»çµ±çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ã€‚æ›´è©³ç´°çš„è¨­å®šå’Œé€²éšåŠŸèƒ½è«‹åƒè€ƒå®Œæ•´æ–‡ä»¶ã€‚