# 考試環境特定配置覆蓋
# 此檔案用於覆蓋基本配置，以適應不同類型的考試需求

# CKA 考試特定配置
cka_config:
  cluster_name: "cka-exam-cluster"

  # 啟用 CKA 相關功能
  audit_log_enabled: true
  audit_log_policy: |
    apiVersion: audit.k8s.io/v1
    kind: Policy
    rules:
    - level: Metadata
      namespaces: ["default", "kube-system"]
      verbs: ["create", "update", "patch", "delete"]
    - level: RequestResponse
      resources:
      - group: ""
        resources: ["pods", "services"]
      - group: "apps"
        resources: ["deployments", "replicasets"]

  # etcd 備份配置
  etcd_backup_enabled: true

  # RBAC 詳細配置
  rbac_enabled: true

  # 節點管理功能
  drain_nodes: true

  # 升級相關設定
  upgrade_cluster_setup: true

# CKAD 考試特定配置
ckad_config:
  cluster_name: "ckad-exam-cluster"

  # 應用程式相關功能
  local_path_provisioner_enabled: true
  metrics_server_enabled: true

  # Ingress 支援
  ingress_nginx_enabled: true

  # ConfigMap 和 Secret 支援增強
  kube_feature_gates:
    - "EphemeralContainers=true"
    - "CSIMigration=true"

# CKS 考試特定配置
cks_config:
  cluster_name: "cks-exam-cluster"

  # 安全相關配置
  authorization_modes: ['Node', 'RBAC']
  rbac_enabled: true

  # Pod 安全標準
  pod_security_enabled: true
  pod_security_policy_enabled: true

  # 網路政策支援
  network_policy_enabled: true

  # 審計加強
  audit_log_enabled: true
  audit_log_policy: |
    apiVersion: audit.k8s.io/v1
    kind: Policy
    rules:
    - level: Metadata
      verbs: ["create", "update", "patch", "delete"]
    - level: RequestResponse
      resources:
      - group: ""
        resources: ["secrets", "configmaps"]
    - level: RequestResponse
      users: ["system:serviceaccount:kube-system:*"]

  # 安全掃描工具
  falco_enabled: true

  # OPA Gatekeeper
  gatekeeper_enabled: false

  # 加密設定
  kube_encrypt_secret_data: true

  # API Server 安全加固
  kube_apiserver_admission_control_config_file: true
  kube_apiserver_admission_plugins:
    - NodeRestriction
    - PodSecurityPolicy
    - ResourceQuota
    - LimitRanger
    - ServiceAccount
    - DefaultStorageClass
    - DefaultTolerationSeconds
    - MutatingAdmissionWebhook
    - ValidatingAdmissionWebhook

# 共同的考試環境優化
exam_optimizations:
  # 加快部署速度
  download_run_once: true
  download_localhost: true

  # 減少資源使用
  kube_memory_reserved: "128Mi"
  kube_cpu_reserved: "50m"

  # 簡化日誌
  docker_log_opts:
    max-size: "10m"
    max-file: "3"

  # 考試時間限制優化
  drain_timeout: 120
  drain_grace_period: 10

  # DNS 優化
  coredns_replicas: 1
  enable_nodelocaldns: false

# 網路配置變體
network_configs:
  # Calico 配置 (預設)
  calico:
    kube_network_plugin: calico
    calico_ipip_mode: "Always"
    calico_vxlan_mode: "Never"

  # Flannel 配置
  flannel:
    kube_network_plugin: flannel
    flannel_backend_type: "vxlan"

  # Cilium 配置
  cilium:
    kube_network_plugin: cilium
    cilium_version: "v1.14.5"

# 節點配置變體
node_configs:
  # 單節點配置
  single_node:
    kube_network_node_prefix: 24
    kubelet_max_pods: 110

  # 多節點配置
  multi_node:
    kube_network_node_prefix: 24
    kubelet_max_pods: 110

  # 高可用性配置
  ha_cluster:
    loadbalancer_apiserver_localhost: false
    kube_apiserver_bind_address: "0.0.0.0"